import{r as d,q as B,g as r,c as i,a as e,d as _,F as K,h as V,t as n,w as T,e as c,v as p,f as F,z as $,o,n as U}from"./index-B_6CzX7_.js";const E={class:"flex justify-between items-center mb-6"},L={class:"card p-0"},R={class:"table-container"},S={class:"data-table"},G={key:0},H={key:1},J={class:"font-medium"},O={class:"flex gap-1"},Q=["onClick"],W=["onClick"],X=["onClick","disabled"],Y={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Z={class:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4"},ee={class:"p-6"},te={class:"text-lg font-semibold mb-4"},se=["disabled"],le={key:0},ae={key:1},ne={class:"flex items-center gap-4"},ie={class:"flex items-center"},oe={class:"flex items-center"},de={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},re={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"},ue={class:"p-6"},ce={class:"flex justify-between items-center mb-4"},ve={class:"text-lg font-semibold"},me={class:"space-y-4"},be={class:"flex gap-2"},pe={class:"table-container"},ye={class:"data-table"},fe={key:0},ge={class:"text-sm bg-gray-100 px-2 py-1 rounded"},_e=["onClick"],we=["onClick","disabled"],he={__name:"Users",setup(xe){const w=d(!0),y=d([]),x=d(!1),k=d(!1),u=d(null),v=d(null),b=d([]),f=d(""),g=d({}),a=d({username:"",email:"",password:"",is_admin:!1,is_active:!0});B(async()=>{await h()});async function h(){w.value=!0;try{const l=await r.getUsers();y.value=l.users||[]}catch(l){console.error("Failed to load users:",l)}finally{w.value=!1}}function D(l){return l?new Date(l).toLocaleDateString():"-"}function M(l){u.value=l,a.value={username:l.username,email:l.email||"",password:"",is_admin:l.is_admin,is_active:l.is_active}}function A(){x.value=!1,u.value=null,a.value={username:"",email:"",password:"",is_admin:!1,is_active:!0}}async function P(){try{const l={...a.value};l.password||delete l.password,u.value?await r.updateUser(u.value.id,l):await r.createUser(l),A(),await h()}catch(l){alert("Failed to save user: "+(l.message||"Unknown error"))}}async function I(l){if(confirm(`Delete user "${l.username}"? This will also delete all their API keys.`))try{await r.deleteUser(l.id),await h()}catch(t){alert("Failed to delete: "+(t.message||"Unknown error"))}}async function N(l){v.value=l,k.value=!0;try{const t=await r.getUserApiKeys(l.id);b.value=t.api_keys||[]}catch(t){console.error("Failed to load API keys:",t)}}function j(l){g.value[l]=!g.value[l]}async function z(){try{await r.createApiKey(v.value.id,{name:f.value||"New Key"}),f.value="";const l=await r.getUserApiKeys(v.value.id);b.value=l.api_keys||[]}catch(l){alert("Failed to create key: "+(l.message||"Unknown error"))}}async function q(l){if(confirm(`Revoke API key "${l.name}"?`))try{await r.revokeApiKey(v.value.id,l.id);const t=await r.getUserApiKeys(v.value.id);b.value=t.api_keys||[]}catch(t){alert("Failed to revoke key: "+(t.message||"Unknown error"))}}return(l,t)=>{var C;return o(),i("div",null,[e("div",E,[t[9]||(t[9]=e("h1",{class:"text-2xl font-bold text-gray-900"},"用户管理",-1)),e("button",{onClick:t[0]||(t[0]=s=>x.value=!0),class:"btn btn-primary"}," 添加用户 ")]),e("div",L,[e("div",R,[e("table",S,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",null,"用户名"),e("th",null,"邮箱"),e("th",null,"角色"),e("th",null,"状态"),e("th",null,"创建时间"),e("th",null,"操作")])],-1)),e("tbody",null,[w.value?(o(),i("tr",G,[...t[10]||(t[10]=[e("td",{colspan:"6",class:"text-center py-8 text-gray-500"},"加载中...",-1)])])):y.value.length===0?(o(),i("tr",H,[...t[11]||(t[11]=[e("td",{colspan:"6",class:"text-center py-8 text-gray-500"},"暂无用户",-1)])])):_("",!0),(o(!0),i(K,null,V(y.value,s=>(o(),i("tr",{key:s.id},[e("td",J,n(s.username),1),e("td",null,n(s.email||"-"),1),e("td",null,[e("span",{class:U(s.is_admin?"badge badge-warning":"badge badge-gray")},n(s.is_admin?"管理员":"普通用户"),3)]),e("td",null,[e("span",{class:U(s.is_active?"badge badge-success":"badge badge-danger")},n(s.is_active?"启用":"禁用"),3)]),e("td",null,n(D(s.created_at)),1),e("td",null,[e("div",O,[e("button",{onClick:m=>N(s),class:"btn btn-sm btn-secondary"}," API Keys ",8,Q),e("button",{onClick:m=>M(s),class:"btn btn-sm btn-secondary"}," Edit ",8,W),e("button",{onClick:m=>I(s),class:"btn btn-sm btn-danger",disabled:s.is_admin&&y.value.filter(m=>m.is_admin).length===1}," Delete ",8,X)])])]))),128))])])])]),x.value||u.value?(o(),i("div",Y,[e("div",Z,[e("div",ee,[e("h3",te,n(u.value?"编辑用户":"添加用户"),1),e("form",{onSubmit:T(P,["prevent"]),class:"space-y-4"},[e("div",null,[t[13]||(t[13]=e("label",{class:"form-label"},"用户名",-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.username=s),class:"form-input",required:"",disabled:!!u.value},null,8,se),[[p,a.value.username]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"form-label"},"邮箱",-1)),c(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.email=s),type:"email",class:"form-input"},null,512),[[p,a.value.email]])]),u.value?(o(),i("div",ae,[t[16]||(t[16]=e("label",{class:"form-label"},"新密码 (留空保持不变)",-1)),c(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.password=s),type:"password",class:"form-input"},null,512),[[p,a.value.password]])])):(o(),i("div",le,[t[15]||(t[15]=e("label",{class:"form-label"},"密码",-1)),c(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.password=s),type:"password",class:"form-input",required:""},null,512),[[p,a.value.password]])])),e("div",ne,[e("label",ie,[c(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a.value.is_admin=s),type:"checkbox",class:"mr-2"},null,512),[[$,a.value.is_admin]]),t[17]||(t[17]=F(" Admin ",-1))]),e("label",oe,[c(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.is_active=s),type:"checkbox",class:"mr-2"},null,512),[[$,a.value.is_active]]),t[18]||(t[18]=F(" Active ",-1))])]),e("div",{class:"flex justify-end gap-2 pt-4"},[e("button",{type:"button",onClick:A,class:"btn btn-secondary"},"取消"),t[19]||(t[19]=e("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])):_("",!0),k.value?(o(),i("div",de,[e("div",re,[e("div",ue,[e("div",ce,[e("h3",ve,"API 密钥 - "+n((C=v.value)==null?void 0:C.username),1),e("button",{onClick:t[7]||(t[7]=s=>k.value=!1),class:"text-gray-500 hover:text-gray-700"}," × ")]),e("div",me,[e("div",be,[c(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>f.value=s),class:"form-input flex-1",placeholder:"密钥名称 (可选)"},null,512),[[p,f.value]]),e("button",{onClick:z,class:"btn btn-primary"},"创建密钥")]),e("div",pe,[e("table",ye,[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"API 密钥"),e("th",null,"状态"),e("th",null,"使用量"),e("th",null,"操作")])],-1)),e("tbody",null,[b.value.length===0?(o(),i("tr",fe,[...t[20]||(t[20]=[e("td",{colspan:"5",class:"text-center py-4 text-gray-500"},"暂无 API 密钥",-1)])])):_("",!0),(o(!0),i(K,null,V(b.value,s=>(o(),i("tr",{key:s.id},[e("td",null,n(s.name),1),e("td",null,[e("code",ge,n(g.value[s.id]?s.api_key:s.api_key.substring(0,20)+"..."),1),e("button",{onClick:m=>j(s.id),class:"ml-2 text-primary-600 text-sm"},n(g.value[s.id]?"隐藏":"显示"),9,_e)]),e("td",null,[e("span",{class:U(s.is_active?"badge badge-success":"badge badge-danger")},n(s.is_active?"启用":"已撤销"),3)]),e("td",null,n(s.daily_usage)+"/"+n(s.daily_limit),1),e("td",null,[e("button",{onClick:m=>q(s),class:"btn btn-sm btn-danger",disabled:!s.is_active}," Revoke ",8,we)])]))),128))])])])])])])])):_("",!0)])}}};export{he as default};

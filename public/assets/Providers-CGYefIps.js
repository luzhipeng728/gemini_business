import{r as i,s as E,q as A,g as v,c as n,a as e,d as x,n as _,t as u,F as C,h as P,w as F,e as r,v as m,x as q,o as a,y as I}from"./index-fcJ6QTK0.js";const T={class:"flex justify-between items-center mb-6"},H={class:"flex gap-2"},L={class:"flex gap-2 mb-4 overflow-x-auto pb-2"},K=["onClick"],Q={class:"card p-0"},W={class:"table-container"},X={class:"data-table"},Y={key:0},Z={key:1},ee={class:"font-medium"},te={class:"flex items-center"},le={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},se={class:"text-sm"},ne={class:"text-gray-900"},ae={key:0,class:"text-red-500 ml-1"},oe={class:"flex gap-1"},ue=["onClick"],ie=["onClick"],re=["onClick"],de={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ve={class:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4"},me={class:"p-6"},be={class:"text-lg font-semibold mb-4"},ce=["value"],pe={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},fe={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"},ge={class:"p-6"},ye={class:"space-y-4"},xe=["value"],ke={class:"flex justify-end gap-2 pt-4"},we={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},_e={class:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4"},Ce={class:"p-6"},Pe={class:"flex justify-end gap-2 pt-4"},Ve={__name:"Providers",setup(Ue){const U=i(!0),g=i([]),y=i([]),c=i(null),S=i(!1),k=i(!1),w=i(!1),p=i(null),o=i({name:"",group_id:null,cookies:"",csesidx:"",max_concurrent:10}),b=i({group_id:null,data:""}),d=i({name:"",description:"",priority:0}),$=E(()=>c.value===null?g.value:g.value.filter(s=>s.group_id===c.value));A(async()=>{await f()});async function f(){U.value=!0;try{const[s,t]=await Promise.all([v.getProviders(),v.getProviderGroups()]);g.value=s.providers||[],y.value=t.groups||[]}catch(s){console.error("Failed to load providers:",s)}finally{U.value=!1}}function G(s){if(!s)return"-";const t=y.value.find(l=>l.id===s);return(t==null?void 0:t.name)||"-"}function M(s){return g.value.filter(t=>t.group_id===s).length}function j(s){return{active:"badge badge-success",cooling:"badge badge-warning",failed:"badge badge-danger",inactive:"badge badge-gray"}[s]||"badge badge-gray"}function D(s){return s>=80?"bg-green-500":s>=50?"bg-yellow-500":"bg-red-500"}function N(s){p.value=s,o.value={name:s.name,group_id:s.group_id,cookies:s.cookies,csesidx:s.csesidx,max_concurrent:s.max_concurrent}}function h(){S.value=!1,p.value=null,o.value={name:"",group_id:null,cookies:"",csesidx:"",max_concurrent:10}}async function B(){try{p.value?await v.updateProvider(p.value.id,o.value):await v.createProvider(o.value),h(),await f()}catch(s){alert("Failed to save provider: "+(s.message||"Unknown error"))}}async function z(){try{const t=JSON.parse(b.value.data).map(l=>({...l,group_id:b.value.group_id}));await v.bulkCreateProviders({providers:t}),k.value=!1,b.value={group_id:null,data:""},await f()}catch(s){alert("Failed to import: "+(s.message||"Invalid JSON"))}}async function J(){try{await v.createProviderGroup(d.value),w.value=!1,d.value={name:"",description:"",priority:0},await f()}catch(s){alert("Failed to save group: "+(s.message||"Unknown error"))}}async function O(s){if(confirm(`Reset stats for ${s.name}?`))try{await v.resetProviderStats(s.id),await f()}catch(t){alert("Failed to reset: "+(t.message||"Unknown error"))}}async function R(s){if(confirm(`Delete provider "${s.name}"? This cannot be undone.`))try{await v.deleteProvider(s.id),await f()}catch(t){alert("Failed to delete: "+(t.message||"Unknown error"))}}return(s,t)=>(a(),n("div",null,[e("div",T,[t[16]||(t[16]=e("h1",{class:"text-2xl font-bold text-gray-900"},"服务商管理",-1)),e("div",H,[e("button",{onClick:t[0]||(t[0]=l=>k.value=!0),class:"btn btn-secondary"}," 批量导入 "),e("button",{onClick:t[1]||(t[1]=l=>S.value=!0),class:"btn btn-primary"}," 添加服务商 ")])]),e("div",L,[e("button",{onClick:t[2]||(t[2]=l=>c.value=null),class:_(["btn btn-sm",c.value===null?"btn-primary":"btn-secondary"])}," All ("+u(g.value.length)+") ",3),(a(!0),n(C,null,P(y.value,l=>(a(),n("button",{key:l.id,onClick:V=>c.value=l.id,class:_(["btn btn-sm",c.value===l.id?"btn-primary":"btn-secondary"])},u(l.name)+" ("+u(M(l.id))+") ",11,K))),128)),e("button",{onClick:t[3]||(t[3]=l=>w.value=!0),class:"btn btn-sm btn-secondary"}," + 分组 ")]),e("div",Q,[e("div",W,[e("table",X,[t[19]||(t[19]=e("thead",null,[e("tr",null,[e("th",null,"名称"),e("th",null,"分组"),e("th",null,"状态"),e("th",null,"健康度"),e("th",null,"负载"),e("th",null,"请求"),e("th",null,"操作")])],-1)),e("tbody",null,[U.value?(a(),n("tr",Y,[...t[17]||(t[17]=[e("td",{colspan:"7",class:"text-center py-8 text-gray-500"},"加载中...",-1)])])):$.value.length===0?(a(),n("tr",Z,[...t[18]||(t[18]=[e("td",{colspan:"7",class:"text-center py-8 text-gray-500"},"暂无服务商",-1)])])):x("",!0),(a(!0),n(C,null,P($.value,l=>(a(),n("tr",{key:l.id},[e("td",ee,u(l.name),1),e("td",null,u(G(l.group_id)),1),e("td",null,[e("span",{class:_(j(l.status))},u(l.status),3)]),e("td",null,[e("div",te,[e("div",le,[e("div",{class:_([D(l.health_score),"h-2 rounded-full"]),style:I({width:l.health_score+"%"})},null,6)]),e("span",se,u(l.health_score)+"%",1)])]),e("td",null,u(l.current_load)+"/"+u(l.max_concurrent),1),e("td",null,[e("span",ne,u(l.total_requests),1),l.failed_requests>0?(a(),n("span",ae," ("+u(l.failed_requests)+" 失败) ",1)):x("",!0)]),e("td",null,[e("div",oe,[e("button",{onClick:V=>N(l),class:"btn btn-sm btn-secondary"}," Edit ",8,ue),e("button",{onClick:V=>O(l),class:"btn btn-sm btn-secondary"}," Reset ",8,ie),e("button",{onClick:V=>R(l),class:"btn btn-sm btn-danger"}," Delete ",8,re)])])]))),128))])])])]),S.value||p.value?(a(),n("div",de,[e("div",ve,[e("div",me,[e("h3",be,u(p.value?"编辑服务商":"添加服务商"),1),e("form",{onSubmit:F(B,["prevent"]),class:"space-y-4"},[e("div",null,[t[20]||(t[20]=e("label",{class:"form-label"},"名称",-1)),r(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>o.value.name=l),class:"form-input",required:""},null,512),[[m,o.value.name]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"form-label"},"分组",-1)),r(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>o.value.group_id=l),class:"form-input"},[t[21]||(t[21]=e("option",{value:null},"无分组",-1)),(a(!0),n(C,null,P(y.value,l=>(a(),n("option",{key:l.id,value:l.id},u(l.name),9,ce))),128))],512),[[q,o.value.group_id]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"form-label"},"Cookies (JSON)",-1)),r(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=l=>o.value.cookies=l),class:"form-input h-32",required:""},null,512),[[m,o.value.cookies]])]),e("div",null,[t[24]||(t[24]=e("label",{class:"form-label"},"CSE Session Index",-1)),r(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>o.value.csesidx=l),class:"form-input",required:""},null,512),[[m,o.value.csesidx]])]),e("div",null,[t[25]||(t[25]=e("label",{class:"form-label"},"最大并发",-1)),r(e("input",{"onUpdate:modelValue":t[8]||(t[8]=l=>o.value.max_concurrent=l),type:"number",min:"1",class:"form-input"},null,512),[[m,o.value.max_concurrent,void 0,{number:!0}]])]),e("div",{class:"flex justify-end gap-2 pt-4"},[e("button",{type:"button",onClick:h,class:"btn btn-secondary"},"取消"),t[26]||(t[26]=e("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])):x("",!0),k.value?(a(),n("div",pe,[e("div",fe,[e("div",ge,[t[30]||(t[30]=e("h3",{class:"text-lg font-semibold mb-4"},"批量导入 Providers",-1)),e("div",ye,[e("div",null,[t[28]||(t[28]=e("label",{class:"form-label"},"分组",-1)),r(e("select",{"onUpdate:modelValue":t[9]||(t[9]=l=>b.value.group_id=l),class:"form-input"},[t[27]||(t[27]=e("option",{value:null},"无分组",-1)),(a(!0),n(C,null,P(y.value,l=>(a(),n("option",{key:l.id,value:l.id},u(l.name),9,xe))),128))],512),[[q,b.value.group_id]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"form-label"},"服务商数据 (JSON 数组)",-1)),r(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>b.value.data=l),class:"form-input h-64 font-mono text-sm",placeholder:'[{"name": "Provider 1", "cookies": {...}, "csesidx": "..."}]'},null,512),[[m,b.value.data]])]),e("div",ke,[e("button",{type:"button",onClick:t[11]||(t[11]=l=>k.value=!1),class:"btn btn-secondary"},"取消"),e("button",{onClick:z,class:"btn btn-primary"},"导入")])])])])])):x("",!0),w.value?(a(),n("div",we,[e("div",_e,[e("div",Ce,[t[35]||(t[35]=e("h3",{class:"text-lg font-semibold mb-4"},"添加服务商 Group",-1)),e("form",{onSubmit:F(J,["prevent"]),class:"space-y-4"},[e("div",null,[t[31]||(t[31]=e("label",{class:"form-label"},"名称",-1)),r(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>d.value.name=l),class:"form-input",required:""},null,512),[[m,d.value.name]])]),e("div",null,[t[32]||(t[32]=e("label",{class:"form-label"},"描述",-1)),r(e("input",{"onUpdate:modelValue":t[13]||(t[13]=l=>d.value.description=l),class:"form-input"},null,512),[[m,d.value.description]])]),e("div",null,[t[33]||(t[33]=e("label",{class:"form-label"},"优先级",-1)),r(e("input",{"onUpdate:modelValue":t[14]||(t[14]=l=>d.value.priority=l),type:"number",class:"form-input"},null,512),[[m,d.value.priority,void 0,{number:!0}]])]),e("div",Pe,[e("button",{type:"button",onClick:t[15]||(t[15]=l=>w.value=!1),class:"btn btn-secondary"},"取消"),t[34]||(t[34]=e("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])):x("",!0)]))}};export{Ve as default};

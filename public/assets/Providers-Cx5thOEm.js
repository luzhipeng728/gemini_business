import{r as u,s as J,q as R,g as c,c as n,a as e,d as f,n as C,t as i,F as h,h as S,w as G,e as r,v as m,x as M,b as A,o,y as L}from"./index-B_6CzX7_.js";const T={class:"flex justify-between items-center mb-6"},W={class:"flex items-center gap-3"},K={class:"flex gap-2"},Q={class:"flex gap-2 mb-4 overflow-x-auto pb-2"},X=["onClick"],Y={class:"card p-0"},Z={class:"table-container"},ee={class:"data-table"},te={key:0},se={key:1},le={class:"font-medium"},ne={class:"flex items-center"},oe={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},ae={class:"text-sm"},ie={class:"text-gray-900"},ue={key:0,class:"text-red-500 ml-1"},re={class:"flex gap-1"},de=["onClick"],ce=["onClick"],me=["onClick"],pe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ve={class:"bg-white rounded-lg shadow-xl w-full max-w-lg mx-4"},be={class:"p-6"},xe={class:"text-lg font-semibold mb-4"},fe=["value"],ge={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ye={class:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"},ke={class:"p-6"},we={class:"space-y-4"},_e=["value"],Ce={class:"flex justify-end gap-2 pt-4"},he={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Se={class:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4"},qe={class:"p-6"},Pe={class:"flex justify-end gap-2 pt-4"},je={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 overflow-y-auto"},$e={class:"bg-white rounded-lg shadow-xl w-full max-w-3xl mx-4 my-8"},Ue={class:"p-6"},Ge={class:"flex justify-between items-center mb-6"},Me={class:"flex justify-end pt-6"},Be={__name:"Providers",setup(Ne){const q=u(!0),g=u([]),y=u([]),v=u(null),P=u(!1),w=u(!1),_=u(!1),k=u(!1),b=u(null),a=u({name:"",group_id:null,cookies:"",csesidx:"",max_concurrent:10}),p=u({group_id:null,data:""}),d=u({name:"",description:"",priority:0}),$=J(()=>v.value===null?g.value:g.value.filter(l=>l.group_id===v.value));R(async()=>{await x()});async function x(){q.value=!0;try{const[l,t]=await Promise.all([c.getProviders(),c.getProviderGroups()]);g.value=l.providers||[],y.value=t.groups||[]}catch(l){console.error("Failed to load providers:",l)}finally{q.value=!1}}function N(l){if(!l)return"-";const t=y.value.find(s=>s.id===l);return(t==null?void 0:t.name)||"-"}function V(l){return g.value.filter(t=>t.group_id===l).length}function B(l){return{active:"badge badge-success",cooling:"badge badge-warning",failed:"badge badge-danger",inactive:"badge badge-gray"}[l]||"badge badge-gray"}function E(l){return l>=80?"bg-green-500":l>=50?"bg-yellow-500":"bg-red-500"}function F(l){b.value=l,a.value={name:l.name,group_id:l.group_id,cookies:l.cookies,csesidx:l.csesidx,max_concurrent:l.max_concurrent}}function U(){P.value=!1,b.value=null,a.value={name:"",group_id:null,cookies:"",csesidx:"",max_concurrent:10}}async function D(){try{b.value?await c.updateProvider(b.value.id,a.value):await c.createProvider(a.value),U(),await x()}catch(l){alert("Failed to save provider: "+(l.message||"Unknown error"))}}async function O(){try{const t=JSON.parse(p.value.data).map(s=>({...s,group_id:p.value.group_id}));await c.bulkCreateProviders({providers:t}),w.value=!1,p.value={group_id:null,data:""},await x()}catch(l){alert("Failed to import: "+(l.message||"Invalid JSON"))}}async function z(){try{await c.createProviderGroup(d.value),_.value=!1,d.value={name:"",description:"",priority:0},await x()}catch(l){alert("Failed to save group: "+(l.message||"Unknown error"))}}async function I(l){if(confirm(`Reset stats for ${l.name}?`))try{await c.resetProviderStats(l.id),await x()}catch(t){alert("Failed to reset: "+(t.message||"Unknown error"))}}async function H(l){if(confirm(`Delete provider "${l.name}"? This cannot be undone.`))try{await c.deleteProvider(l.id),await x()}catch(t){alert("Failed to delete: "+(t.message||"Unknown error"))}}return(l,t)=>(o(),n("div",null,[e("div",T,[e("div",W,[t[21]||(t[21]=e("h1",{class:"text-2xl font-bold text-gray-900"},"服务商管理",-1)),e("button",{onClick:t[0]||(t[0]=s=>k.value=!0),class:"text-blue-600 hover:text-blue-700",title:"查看帮助"},[...t[20]||(t[20]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])])]),e("div",K,[e("button",{onClick:t[1]||(t[1]=s=>k.value=!0),class:"btn btn-secondary"}," 帮助教程 "),e("button",{onClick:t[2]||(t[2]=s=>w.value=!0),class:"btn btn-secondary"}," 批量导入 "),e("button",{onClick:t[3]||(t[3]=s=>P.value=!0),class:"btn btn-primary"}," 添加服务商 ")])]),e("div",Q,[e("button",{onClick:t[4]||(t[4]=s=>v.value=null),class:C(["btn btn-sm",v.value===null?"btn-primary":"btn-secondary"])}," All ("+i(g.value.length)+") ",3),(o(!0),n(h,null,S(y.value,s=>(o(),n("button",{key:s.id,onClick:j=>v.value=s.id,class:C(["btn btn-sm",v.value===s.id?"btn-primary":"btn-secondary"])},i(s.name)+" ("+i(V(s.id))+") ",11,X))),128)),e("button",{onClick:t[5]||(t[5]=s=>_.value=!0),class:"btn btn-sm btn-secondary"}," + 分组 ")]),e("div",Y,[e("div",Z,[e("table",ee,[t[24]||(t[24]=e("thead",null,[e("tr",null,[e("th",null,"名称"),e("th",null,"分组"),e("th",null,"状态"),e("th",null,"健康度"),e("th",null,"负载"),e("th",null,"请求"),e("th",null,"操作")])],-1)),e("tbody",null,[q.value?(o(),n("tr",te,[...t[22]||(t[22]=[e("td",{colspan:"7",class:"text-center py-8 text-gray-500"},"加载中...",-1)])])):$.value.length===0?(o(),n("tr",se,[...t[23]||(t[23]=[e("td",{colspan:"7",class:"text-center py-8 text-gray-500"},"暂无服务商",-1)])])):f("",!0),(o(!0),n(h,null,S($.value,s=>(o(),n("tr",{key:s.id},[e("td",le,i(s.name),1),e("td",null,i(N(s.group_id)),1),e("td",null,[e("span",{class:C(B(s.status))},i(s.status),3)]),e("td",null,[e("div",ne,[e("div",oe,[e("div",{class:C([E(s.health_score),"h-2 rounded-full"]),style:L({width:s.health_score+"%"})},null,6)]),e("span",ae,i(s.health_score)+"%",1)])]),e("td",null,i(s.current_load)+"/"+i(s.max_concurrent),1),e("td",null,[e("span",ie,i(s.total_requests),1),s.failed_requests>0?(o(),n("span",ue," ("+i(s.failed_requests)+" 失败) ",1)):f("",!0)]),e("td",null,[e("div",re,[e("button",{onClick:j=>F(s),class:"btn btn-sm btn-secondary"}," Edit ",8,de),e("button",{onClick:j=>I(s),class:"btn btn-sm btn-secondary"}," Reset ",8,ce),e("button",{onClick:j=>H(s),class:"btn btn-sm btn-danger"}," Delete ",8,me)])])]))),128))])])])]),P.value||b.value?(o(),n("div",pe,[e("div",ve,[e("div",be,[e("h3",xe,i(b.value?"编辑服务商":"添加服务商"),1),e("form",{onSubmit:G(D,["prevent"]),class:"space-y-4"},[e("div",null,[t[25]||(t[25]=e("label",{class:"form-label"},"名称",-1)),r(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.name=s),class:"form-input",required:""},null,512),[[m,a.value.name]])]),e("div",null,[t[27]||(t[27]=e("label",{class:"form-label"},"分组",-1)),r(e("select",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.group_id=s),class:"form-input"},[t[26]||(t[26]=e("option",{value:null},"无分组",-1)),(o(!0),n(h,null,S(y.value,s=>(o(),n("option",{key:s.id,value:s.id},i(s.name),9,fe))),128))],512),[[M,a.value.group_id]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"form-label"},"Cookies (JSON)",-1)),r(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.cookies=s),class:"form-input h-32",required:""},null,512),[[m,a.value.cookies]])]),e("div",null,[t[29]||(t[29]=e("label",{class:"form-label"},"CSE Session Index",-1)),r(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.csesidx=s),class:"form-input",required:""},null,512),[[m,a.value.csesidx]])]),e("div",null,[t[30]||(t[30]=e("label",{class:"form-label"},"最大并发",-1)),r(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>a.value.max_concurrent=s),type:"number",min:"1",class:"form-input"},null,512),[[m,a.value.max_concurrent,void 0,{number:!0}]])]),e("div",{class:"flex justify-end gap-2 pt-4"},[e("button",{type:"button",onClick:U,class:"btn btn-secondary"},"取消"),t[31]||(t[31]=e("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])):f("",!0),w.value?(o(),n("div",ge,[e("div",ye,[e("div",ke,[t[35]||(t[35]=e("h3",{class:"text-lg font-semibold mb-4"},"批量导入 Providers",-1)),e("div",we,[e("div",null,[t[33]||(t[33]=e("label",{class:"form-label"},"分组",-1)),r(e("select",{"onUpdate:modelValue":t[11]||(t[11]=s=>p.value.group_id=s),class:"form-input"},[t[32]||(t[32]=e("option",{value:null},"无分组",-1)),(o(!0),n(h,null,S(y.value,s=>(o(),n("option",{key:s.id,value:s.id},i(s.name),9,_e))),128))],512),[[M,p.value.group_id]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"form-label"},"服务商数据 (JSON 数组)",-1)),r(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=s=>p.value.data=s),class:"form-input h-64 font-mono text-sm",placeholder:'[{"name": "Provider 1", "cookies": {...}, "csesidx": "..."}]'},null,512),[[m,p.value.data]])]),e("div",Ce,[e("button",{type:"button",onClick:t[13]||(t[13]=s=>w.value=!1),class:"btn btn-secondary"},"取消"),e("button",{onClick:O,class:"btn btn-primary"},"导入")])])])])])):f("",!0),_.value?(o(),n("div",he,[e("div",Se,[e("div",qe,[t[40]||(t[40]=e("h3",{class:"text-lg font-semibold mb-4"},"添加服务商分组",-1)),e("form",{onSubmit:G(z,["prevent"]),class:"space-y-4"},[e("div",null,[t[36]||(t[36]=e("label",{class:"form-label"},"名称",-1)),r(e("input",{"onUpdate:modelValue":t[14]||(t[14]=s=>d.value.name=s),class:"form-input",required:""},null,512),[[m,d.value.name]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"form-label"},"描述",-1)),r(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>d.value.description=s),class:"form-input"},null,512),[[m,d.value.description]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"form-label"},"优先级",-1)),r(e("input",{"onUpdate:modelValue":t[16]||(t[16]=s=>d.value.priority=s),type:"number",class:"form-input"},null,512),[[m,d.value.priority,void 0,{number:!0}]])]),e("div",Pe,[e("button",{type:"button",onClick:t[17]||(t[17]=s=>_.value=!1),class:"btn btn-secondary"},"取消"),t[39]||(t[39]=e("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])):f("",!0),k.value?(o(),n("div",je,[e("div",$e,[e("div",Ue,[e("div",Ge,[t[42]||(t[42]=e("h3",{class:"text-xl font-semibold text-gray-900"},"服务商添加教程",-1)),e("button",{onClick:t[18]||(t[18]=s=>k.value=!1),class:"text-gray-400 hover:text-gray-600"},[...t[41]||(t[41]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t[43]||(t[43]=A(`<div class="space-y-6 text-gray-700"><div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded"><h4 class="font-semibold text-blue-800 mb-2">什么是服务商？</h4><p class="text-sm text-blue-700">服务商是 Gemini Business 账号的配置信息，系统会自动在多个服务商之间进行负载均衡和故障转移。</p></div><div><h4 class="font-semibold text-gray-900 mb-3">添加服务商需要以下信息：</h4><div class="space-y-4"><div class="bg-gray-50 p-4 rounded-lg"><div class="flex items-start gap-3"><span class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-medium">1</span><div><h5 class="font-medium text-gray-900">Cookies (核心必填)</h5><p class="text-sm text-gray-600 mt-1">从浏览器获取的 Gemini Business 登录 Cookies，支持 JSON 格式或字符串格式。</p><div class="mt-2 bg-gray-100 p-3 rounded text-xs font-mono overflow-x-auto"><pre class="whitespace-pre-wrap">{
  &quot;NID&quot;: &quot;xxx...&quot;,
  &quot;__Secure-C_SES&quot;: &quot;CSE.xxx...&quot;,
  &quot;__Host-C_OSES&quot;: &quot;COS.xxx...&quot;
}</pre></div><p class="text-xs text-gray-500 mt-2">或直接粘贴 Cookie 字符串：<code class="bg-gray-100 px-1 rounded">NID=xxx; __Secure-C_SES=xxx; __Host-C_OSES=xxx</code></p></div></div></div><div class="bg-gray-50 p-4 rounded-lg"><div class="flex items-start gap-3"><span class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-medium">2</span><div><h5 class="font-medium text-gray-900">CSE Session Index (csesidx)</h5><p class="text-sm text-gray-600 mt-1">Gemini Business 会话索引，从网络请求中获取。</p><p class="text-xs text-gray-500 mt-1">示例值: <code class="bg-gray-100 px-1 rounded">1585284838</code></p></div></div></div><div class="bg-gray-50 p-4 rounded-lg"><div class="flex items-start gap-3"><span class="flex-shrink-0 w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-sm font-medium">3</span><div><h5 class="font-medium text-gray-900">名称 (可选)</h5><p class="text-sm text-gray-600 mt-1">便于识别的名称，如 &quot;主账号&quot;、&quot;备用1&quot; 等。</p></div></div></div><div class="bg-gray-50 p-4 rounded-lg"><div class="flex items-start gap-3"><span class="flex-shrink-0 w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-sm font-medium">4</span><div><h5 class="font-medium text-gray-900">最大并发数 (可选)</h5><p class="text-sm text-gray-600 mt-1">默认为 10，可根据账号限额调整。</p></div></div></div></div></div><div><h4 class="font-semibold text-gray-900 mb-3">如何获取 Cookies 和 csesidx？</h4><ol class="space-y-2 text-sm"><li class="flex gap-2"><span class="text-blue-500 font-medium">1.</span><span>打开浏览器，访问 <code class="bg-gray-100 px-1 rounded">https://business.gemini.google</code></span></li><li class="flex gap-2"><span class="text-blue-500 font-medium">2.</span><span>使用 Google Workspace 账号登录</span></li><li class="flex gap-2"><span class="text-blue-500 font-medium">3.</span><span>按 F12 打开开发者工具，切换到 &quot;Network&quot; (网络) 选项卡</span></li><li class="flex gap-2"><span class="text-blue-500 font-medium">4.</span><span>发送一条消息，找到请求 URL 中的 <code class="bg-gray-100 px-1 rounded">csesidx=xxx</code> 参数</span></li><li class="flex gap-2"><span class="text-blue-500 font-medium">5.</span><span>切换到 &quot;Application&quot; → &quot;Cookies&quot; → <code class="bg-gray-100 px-1 rounded">https://business.gemini.google</code></span></li><li class="flex gap-2"><span class="text-blue-500 font-medium">6.</span><span>复制 <code class="bg-gray-100 px-1 rounded">NID</code>、<code class="bg-gray-100 px-1 rounded">__Secure-C_SES</code>、<code class="bg-gray-100 px-1 rounded">__Host-C_OSES</code> 的值</span></li></ol></div><div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded"><h4 class="font-semibold text-yellow-800 mb-2">注意事项</h4><ul class="text-sm text-yellow-700 space-y-1"><li>• Cookies 会过期，如果服务商状态变为 &quot;failed&quot;，需要更新 Cookies</li><li>• 建议添加多个服务商账号，实现负载均衡和高可用</li><li>• 需要 Google Workspace 企业账号才能访问 Gemini Business</li></ul></div></div>`,1)),e("div",Me,[e("button",{onClick:t[19]||(t[19]=s=>k.value=!1),class:"btn btn-primary"},"我知道了")])])])])):f("",!0)]))}};export{Be as default};

import{r as u,q as S,g as c,c as i,a as t,e as m,x as f,F as y,h as _,d as D,t as n,o as r,n as F}from"./index-fcJ6QTK0.js";const $={class:"card mb-6"},M={class:"flex gap-4 items-end"},B=["value"],U={class:"card p-0"},V={class:"table-container"},A={class:"data-table"},N={key:0},P={key:1},j={class:"text-xs bg-gray-100 px-2 py-1 rounded"},E=["onClick"],L={class:"p-4 border-t flex justify-between items-center"},q={class:"text-sm text-gray-600"},z={class:"flex gap-2"},G=["disabled"],H={class:"px-3 py-1.5 text-sm"},I=["disabled"],Q={__name:"Sessions",setup(J){const v=u(!0),p=u([]),g=u([]),o=u({status:"",provider_id:""}),l=u({page:1,limit:20,total:0});S(async()=>{try{const s=await c.getProviders();g.value=s.providers||[]}catch(s){console.error("Failed to load providers:",s)}await d()});async function d(){v.value=!0;try{const s={page:l.value.page,limit:l.value.limit,...o.value.status&&{status:o.value.status},...o.value.provider_id&&{provider_id:o.value.provider_id}},e=await c.getSessions(s);p.value=e.sessions||[],l.value.total=e.total||0}catch(s){console.error("Failed to load sessions:",s)}finally{v.value=!1}}function x(s){const e=g.value.find(a=>a.id===s);return(e==null?void 0:e.name)||`#${s}`}function h(s){return{active:"badge badge-success",expired:"badge badge-gray",migrated:"badge badge-warning"}[s]||"badge badge-gray"}function k(s){return s?new Date(s).toLocaleString():"-"}function b(s){l.value.page=s,d()}async function w(s){if(confirm(`Delete session #${s.id}?`))try{await c.deleteSession(s.id),await d()}catch(e){alert("Failed to delete: "+(e.message||"Unknown error"))}}async function C(){if(confirm("Delete all expired sessions?"))try{const s=await c.cleanupSessions();alert(`Cleaned up ${s.deleted||0} sessions`),await d()}catch(s){alert("Failed to cleanup: "+(s.message||"Unknown error"))}}return(s,e)=>(r(),i("div",null,[t("div",{class:"flex justify-between items-center mb-6"},[e[4]||(e[4]=t("h1",{class:"text-2xl font-bold text-gray-900"},"会话管理",-1)),t("button",{onClick:C,class:"btn btn-secondary"}," 清理过期 ")]),t("div",$,[t("div",M,[t("div",null,[e[6]||(e[6]=t("label",{class:"form-label"},"状态",-1)),m(t("select",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.status=a),class:"form-input"},[...e[5]||(e[5]=[t("option",{value:""},"All",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"expired"},"Expired",-1),t("option",{value:"migrated"},"Migrated",-1)])],512),[[f,o.value.status]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"form-label"},"服务商",-1)),m(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.provider_id=a),class:"form-input"},[e[7]||(e[7]=t("option",{value:""},"All",-1)),(r(!0),i(y,null,_(g.value,a=>(r(),i("option",{key:a.id,value:a.id},n(a.name),9,B))),128))],512),[[f,o.value.provider_id]])]),t("button",{onClick:d,class:"btn btn-primary"},"筛选")])]),t("div",U,[t("div",V,[t("table",A,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"服务商"),t("th",null,"用户"),t("th",null,"状态"),t("th",null,"消息数"),t("th",null,"上下文哈希"),t("th",null,"最后访问"),t("th",null,"操作")])],-1)),t("tbody",null,[v.value?(r(),i("tr",N,[...e[9]||(e[9]=[t("td",{colspan:"8",class:"text-center py-8 text-gray-500"},"加载中...",-1)])])):p.value.length===0?(r(),i("tr",P,[...e[10]||(e[10]=[t("td",{colspan:"8",class:"text-center py-8 text-gray-500"},"暂无会话",-1)])])):D("",!0),(r(!0),i(y,null,_(p.value,a=>(r(),i("tr",{key:a.id},[t("td",null,n(a.id),1),t("td",null,n(x(a.provider_id)),1),t("td",null,n(a.user_id||"-"),1),t("td",null,[t("span",{class:F(h(a.status))},n(a.status),3)]),t("td",null,n(a.message_count),1),t("td",null,[t("code",j,n(a.context_hash_head.substring(0,8))+"..."+n(a.context_hash_tail.substring(0,8)),1)]),t("td",null,n(k(a.last_accessed_at)),1),t("td",null,[t("button",{onClick:K=>w(a),class:"btn btn-sm btn-danger"}," Delete ",8,E)])]))),128))])])]),t("div",L,[t("div",q," 共计: "+n(l.value.total)+" sessions ",1),t("div",z,[t("button",{onClick:e[2]||(e[2]=a=>b(l.value.page-1)),disabled:l.value.page<=1,class:"btn btn-sm btn-secondary"}," 上一页 ",8,G),t("span",H," 第 "+n(l.value.page)+" 页，共 "+n(Math.ceil(l.value.total/l.value.limit)||1),1),t("button",{onClick:e[3]||(e[3]=a=>b(l.value.page+1)),disabled:l.value.page>=Math.ceil(l.value.total/l.value.limit),class:"btn btn-sm btn-secondary"}," 下一页 ",8,I)])])])]))}};export{Q as default};

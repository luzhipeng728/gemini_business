import{r as i,q as L,g as _,c as r,a as e,e as d,x as f,F as g,h as x,v as M,d as k,t as n,o as u,n as w,f as N}from"./index-D0ggnYb4.js";const D={class:"card mb-6"},F={class:"flex flex-wrap gap-4 items-end"},P=["value"],$=["value"],B={class:"card p-0"},S={class:"table-container"},T={class:"data-table"},j={key:0},q={key:1},R={class:"text-sm"},z={class:"text-xs bg-gray-100 px-2 py-1 rounded"},E={class:"text-green-600"},A={class:"text-blue-600"},G=["title"],H={class:"p-4 border-t flex justify-between items-center"},J={class:"text-sm text-gray-600"},K={class:"flex gap-2"},O=["disabled"],Q={class:"px-3 py-1.5 text-sm"},W=["disabled"],Z={__name:"Logs",setup(X){const v=i(!0),p=i([]),m=i([]),c=i([]),a=i({user_id:"",provider_id:"",model:"",status_code:""}),o=i({page:1,limit:50,total:0});L(async()=>{try{const[l,t]=await Promise.all([_.getUsers(),_.getProviders()]);m.value=l.users||[],c.value=t.providers||[]}catch(l){console.error("Failed to load filters:",l)}await b()});async function b(){v.value=!0;try{const l={page:o.value.page,limit:o.value.limit,...a.value.user_id&&{user_id:a.value.user_id},...a.value.provider_id&&{provider_id:a.value.provider_id},...a.value.model&&{model:a.value.model},...a.value.status_code&&{status_code:a.value.status_code}},t=await _.getLogs(l);p.value=t.logs||[],o.value.total=t.total||0}catch(l){console.error("Failed to load logs:",l)}finally{v.value=!1}}function V(l){if(!l)return"-";const t=m.value.find(s=>s.id===l);return(t==null?void 0:t.username)||`#${l}`}function C(l){if(!l)return"-";const t=c.value.find(s=>s.id===l);return(t==null?void 0:t.name)||`#${l}`}function U(l){return l>=500?"badge badge-danger":l>=400?"badge badge-warning":"badge badge-success"}function h(l){return l?new Date(l).toLocaleString():"-"}function y(l){o.value.page=l,b()}return(l,t)=>(u(),r("div",null,[t[17]||(t[17]=e("div",{class:"flex justify-between items-center mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900"},"请求日志")],-1)),e("div",D,[e("div",F,[e("div",null,[t[7]||(t[7]=e("label",{class:"form-label"},"用户",-1)),d(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.user_id=s),class:"form-input"},[t[6]||(t[6]=e("option",{value:""},"全部",-1)),(u(!0),r(g,null,x(m.value,s=>(u(),r("option",{key:s.id,value:s.id},n(s.username),9,P))),128))],512),[[f,a.value.user_id]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"form-label"},"服务商",-1)),d(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.provider_id=s),class:"form-input"},[t[8]||(t[8]=e("option",{value:""},"全部",-1)),(u(!0),r(g,null,x(c.value,s=>(u(),r("option",{key:s.id,value:s.id},n(s.name),9,$))),128))],512),[[f,a.value.provider_id]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"form-label"},"模型",-1)),d(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.model=s),class:"form-input",placeholder:"e.g. gemini-2.0-flash"},null,512),[[M,a.value.model]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"form-label"},"状态",-1)),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.status_code=s),class:"form-input"},[...t[11]||(t[11]=[e("option",{value:""},"全部",-1),e("option",{value:"200"},"成功 (200)",-1),e("option",{value:"400"},"错误请求 (4xx)",-1),e("option",{value:"500"},"服务错误 (5xx)",-1)])],512),[[f,a.value.status_code]])]),e("button",{onClick:b,class:"btn btn-primary"},"筛选")])]),e("div",B,[e("div",S,[e("table",T,[t[16]||(t[16]=e("thead",null,[e("tr",null,[e("th",null,"时间"),e("th",null,"用户"),e("th",null,"服务商"),e("th",null,"模型"),e("th",null,"类型"),e("th",null,"Token"),e("th",null,"延迟"),e("th",null,"状态")])],-1)),e("tbody",null,[v.value?(u(),r("tr",j,[...t[13]||(t[13]=[e("td",{colspan:"8",class:"text-center py-8 text-gray-500"},"加载中...",-1)])])):p.value.length===0?(u(),r("tr",q,[...t[14]||(t[14]=[e("td",{colspan:"8",class:"text-center py-8 text-gray-500"},"暂无日志",-1)])])):k("",!0),(u(!0),r(g,null,x(p.value,s=>(u(),r("tr",{key:s.id,class:w({"bg-red-50":s.status_code>=400})},[e("td",R,n(h(s.created_at)),1),e("td",null,n(V(s.user_id)),1),e("td",null,n(C(s.provider_id)),1),e("td",null,[e("code",z,n(s.model),1)]),e("td",null,n(s.request_type),1),e("td",null,[e("span",E,n(s.input_tokens||0),1),t[15]||(t[15]=N(" / ",-1)),e("span",A,n(s.output_tokens||0),1)]),e("td",null,n(s.latency_ms)+"ms",1),e("td",null,[e("span",{class:w(U(s.status_code))},n(s.status_code),3),s.error_message?(u(),r("span",{key:0,class:"block text-xs text-red-600 max-w-xs truncate",title:s.error_message},n(s.error_message),9,G)):k("",!0)])],2))),128))])])]),e("div",H,[e("div",J," 共计: "+n(o.value.total)+" 条日志 ",1),e("div",K,[e("button",{onClick:t[4]||(t[4]=s=>y(o.value.page-1)),disabled:o.value.page<=1,class:"btn btn-sm btn-secondary"}," 上一页 ",8,O),e("span",Q," 第 "+n(o.value.page)+" 页，共 "+n(Math.ceil(o.value.total/o.value.limit)||1),1),e("button",{onClick:t[5]||(t[5]=s=>y(o.value.page+1)),disabled:o.value.page>=Math.ceil(o.value.total/o.value.limit),class:"btn btn-sm btn-secondary"}," 下一页 ",8,W)])])])]))}};export{Z as default};
